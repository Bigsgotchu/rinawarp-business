<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RinaWarp Dev Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --rw-hot-pink: #e9007f;
      --rw-coral: #ff6f61;
      --rw-teal: #00ff99;
      --rw-blue: #00b4ff;
      --rw-bg: #050816;
      --rw-text: #e5e7eb;
      --rw-muted: #94a3b8;
      --rw-border: #1e293b;
      --rw-radius-lg: 16px;
      --rw-radius-md: 10px;
      --rw-shadow: 0 20px 45px rgba(0, 0, 0, 0.45);
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 40%, #000 100%);
      color: var(--rw-text);
      font-size: 13px;
    }

    .page {
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-row img {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      box-shadow: 0 0 18px rgba(233, 0, 127, 0.7);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-title {
      font-weight: 600;
      letter-spacing: 0.03em;
      font-size: 13px;
    }

    .logo-subtitle {
      font-size: 11px;
      color: var(--rw-muted);
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: linear-gradient(135deg, var(--rw-hot-pink), var(--rw-blue));
      box-shadow: 0 0 14px rgba(233, 0, 127, 0.6);
    }

    .grid {
      display: grid;
      grid-template-columns: 1.4fr 1.1fr;
      gap: 10px;
    }

    .card {
      background: radial-gradient(circle at top left, #0b1120 0, #020617 60%);
      border-radius: var(--rw-radius-lg);
      padding: 10px 12px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--rw-shadow);
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      inset: -40px;
      background: radial-gradient(circle at top right, rgba(233, 0, 127, 0.08), transparent 60%);
      opacity: 0.9;
      pointer-events: none;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--rw-muted);
      margin-top: 1px;
    }

    .pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--rw-muted);
      background: rgba(15, 23, 42, 0.7);
    }

    .seat-row {
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    .seat-bar-outer {
      flex: 1;
      height: 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .seat-bar-inner {
      height: 100%;
      width: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--rw-teal), var(--rw-hot-pink));
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.6);
      transition: width 0.4s ease-out;
    }

    .seat-text {
      font-size: 11px;
      color: var(--rw-muted);
      min-width: 90px;
      text-align: right;
    }

    .license-status {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 11px;
      position: relative;
      z-index: 1;
    }

    .license-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.7);
    }

    .status-text {
      font-size: 11px;
      color: #bbf7d0;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .license-tier {
      font-size: 11px;
      color: var(--rw-text);
    }

    .license-tier span {
      color: var(--rw-hot-pink);
      font-weight: 600;
    }

    .btn-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    button.rw-btn {
      border-radius: 999px;
      border: none;
      font-size: 11px;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .rw-btn-primary {
      background: linear-gradient(135deg, var(--rw-hot-pink), var(--rw-teal));
      color: #f9fafb;
      box-shadow: 0 0 18px rgba(233, 0, 127, 0.7);
    }

    .rw-btn-ghost {
      background: rgba(15, 23, 42, 0.9);
      color: var(--rw-muted);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .rw-btn-sm {
      padding: 4px 10px;
      font-size: 10px;
    }

    .section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--rw-muted);
      margin-bottom: 2px;
    }

    .model-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }

    select {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 4px 8px;
      color: var(--rw-text);
      font-size: 11px;
      outline: none;
    }

    .pill-mini {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--rw-muted);
    }

    .list {
      font-size: 11px;
      max-height: 190px;
      overflow-y: auto;
      position: relative;
      z-index: 1;
    }

    .list-item {
      border-radius: var(--rw-radius-md);
      border: 1px solid rgba(30, 64, 175, 0.6);
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.25), rgba(15, 23, 42, 0.9));
      padding: 6px 8px;
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .list-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .list-item-title {
      font-size: 11px;
      font-weight: 500;
    }

    .list-item-meta {
      font-size: 10px;
      color: var(--rw-muted);
      display: flex;
      gap: 6px;
    }

    .list-item-body {
      font-size: 11px;
      color: #e5e7eb;
      margin-top: 2px;
      white-space: pre-wrap;
    }

    .list-empty {
      font-size: 11px;
      color: var(--rw-muted);
      margin-top: 4px;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .chip {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--rw-muted);
      background: rgba(15, 23, 42, 0.9);
    }

    .footer {
      margin-top: 4px;
      font-size: 10px;
      color: var(--rw-muted);
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="logo-row">
        <img src="__RINAWARP_LOGO__" alt="RinaWarp" />
        <div class="logo-text">
          <div class="logo-title">RinaWarp Terminal Pro</div>
          <div class="logo-subtitle">VS Code Companion ‚Ä¢ Mermaid Mode</div>
        </div>
      </div>
      <div class="badge">Founder Wave</div>
    </div>

    <div class="grid">
      <!-- Left: Status + Deploy + AI -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Live Status</div>
            <div class="card-subtitle">License ‚Ä¢ Seats ‚Ä¢ Deploy ‚Ä¢ AI Model</div>
          </div>
          <button class="rw-btn rw-btn-ghost rw-btn-sm" id="btn-refresh">
            Refresh
          </button>
        </div>

        <div class="seat-row">
          <div class="seat-bar-outer">
            <div class="seat-bar-inner" id="seat-bar"></div>
          </div>
          <div class="seat-text" id="seat-text">‚Äì / ‚Äì seats</div>
        </div>

        <div class="license-status">
          <div class="license-row">
            <div class="status-text" id="license-status">
              <span class="status-dot"></span>
              <span>Checking license‚Ä¶</span>
            </div>
            <div class="license-tier" id="license-tier"></div>
          </div>
          <div class="license-row">
            <div class="section-title">AI Provider</div>
            <div class="model-row">
              <select id="model-select">
                <option value="gpt-4o">GPT-4o (OpenAI)</option>
                <option value="claude-3.5">Claude 3.5</option>
                <option value="groq-llama3">Groq Llama3</option>
                <option value="ollama-codellama">Ollama CodeLlama</option>
              </select>
              <span class="pill-mini" id="api-url-pill">API: ‚Äì</span>
            </div>
          </div>
        </div>

        <div class="btn-row">
          <button class="rw-btn rw-btn-primary" id="btn-deploy">
            üöÄ Run Deploy
          </button>
          <button class="rw-btn rw-btn-ghost" id="btn-login">
            üîê Login / Manage License
          </button>
          <button class="rw-btn rw-btn-ghost rw-btn-sm" id="btn-ai">
            üí° AI Suggestions
          </button>
        </div>
      </div>

      <!-- Right: AI Suggestions -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">AI Suggestions</div>
            <div class="card-subtitle">Smart fixes from RinaWarp's multi-model brain</div>
          </div>
          <span class="pill">GPT / Claude / Groq / Ollama</span>
        </div>

        <div class="list" id="ai-list">
          <div class="list-empty">
            No suggestions yet. Click <strong>AI Suggestions</strong> to analyze your latest errors.
          </div>
        </div>
      </div>
    </div>

    <!-- Recent errors / commands -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Recent Commands & Errors</div>
          <div class="card-subtitle">Sourced from kilo-memory.json</div>
        </div>
      </div>

      <div class="list" id="logs-list">
        <div class="list-empty">
          No kilo-memory.json data found yet. Once you run Kilo, recent commands & errors will appear here.
        </div>
      </div>

      <div class="footer">
        RinaWarp VS Code Companion ‚Ä¢ Built for your founder wave ‚ú¶
      </div>
    </div>
  </div>

  <script>
    const vscode = acquireVsCodeApi();

    const seatBar = document.getElementById('seat-bar');
    const seatText = document.getElementById('seat-text');
    const licenseStatus = document.getElementById('license-status');
    const licenseTier = document.getElementById('license-tier');
    const apiUrlPill = document.getElementById('api-url-pill');
    const modelSelect = document.getElementById('model-select');
    const logsList = document.getElementById('logs-list');
    const aiList = document.getElementById('ai-list');

    function setSeatState(seats) {
      if (!seats || typeof seats.total !== 'number' || typeof seats.remaining !== 'number') {
        seatBar.style.width = '100%';
        seatText.textContent = '‚Äì / ‚Äì seats';
        return;
      }
      const { total, remaining } = seats;
      const used = total - remaining;
      const pct = total > 0 ? (remaining / total) * 100 : 100;
      seatBar.style.width = pct.toFixed(1) + '%';
      seatText.textContent = `${remaining} / ${total} seats left`;
    }

    function setLicenseState(license) {
      const dot = licenseStatus.querySelector('.status-dot');
      const textSpan = licenseStatus.querySelector('span:nth-child(2)');

      if (!license || !license.valid) {
        dot.style.background = '#f97316';
        dot.style.boxShadow = '0 0 10px rgba(249,115,22,0.8)';
        textSpan.textContent = 'Not activated ‚Ä¢ Click Login to connect RinaWarp.';
        licenseTier.textContent = '';
        return;
      }

      dot.style.background = '#22c55e';
      dot.style.boxShadow = '0 0 10px rgba(34,197,94,0.8)';

      const tierLabel = (license.tier || 'Unknown').toUpperCase();
      textSpan.textContent = 'License active';
      licenseTier.innerHTML = `Tier: <span>${tierLabel}</span>`;
    }

    function setApiUrl(base) {
      if (!base) {
        apiUrlPill.textContent = 'API: ‚Äì';
      } else {
        apiUrlPill.textContent = 'API: ' + base.replace(/^https?:\/\//, '');
      }
    }

    function renderLogs(payload) {
      const { recentErrors = [], recentCommands = [] } = payload || {};

      if ((!recentErrors || recentErrors.length === 0) &&
          (!recentCommands || recentCommands.length === 0)) {
        logsList.innerHTML = '<div class="list-empty">No recent Kilo logs detected yet.</div>';
        return;
      }

      const items = [];

      recentErrors.forEach((err, idx) => {
        items.push({
          type: 'error',
          title: err.label || 'Error #' + (idx + 1),
          meta: err.timestamp || '',
          body: err.message || JSON.stringify(err, null, 2)
        });
      });

      recentCommands.forEach((cmd, idx) => {
        items.push({
          type: 'command',
          title: cmd.label || 'Command #' + (idx + 1),
          meta: cmd.timestamp || '',
          body: cmd.command || JSON.stringify(cmd, null, 2)
        });
      });

      items.sort((a, b) => (b.meta || '').localeCompare(a.meta || ''));

      logsList.innerHTML = items.map(item => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">${item.type === 'error' ? '‚ö†Ô∏è' : 'üíª'} ${item.title}</div>
            <div class="list-item-meta">
              <span>${item.meta || ''}</span>
              <span>${item.type === 'error' ? 'Error' : 'Command'}</span>
            </div>
          </div>
          <div class="list-item-body">${(item.body || '').slice(0, 320)}</div>
        </div>
      `).join('');
    }

    function renderAiSuggestions(res) {
      if (!res || !res.suggestions || res.suggestions.length === 0) {
        aiList.innerHTML = '<div class="list-empty">No suggestions returned. Try again after running some commands / encountering an error.</div>';
        return;
      }

      aiList.innerHTML = res.suggestions.map((s, idx) => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">üí° Suggestion #${idx + 1}</div>
            <div class="list-item-meta">
              <span>${s.model || 'model'}</span>
              <span>${s.severity || 'info'}</span>
            </div>
          </div>
          <div class="list-item-body">${(s.text || '').slice(0, 420)}</div>
          ${s.steps && s.steps.length ? `
            <div class="chips">
              ${s.steps.map(st => `<span class="chip">${st}</span>`).join('')}
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    document.getElementById('btn-refresh').addEventListener('click', () => {
      vscode.postMessage({ type: 'refreshState' });
    });

    document.getElementById('btn-deploy').addEventListener('click', () => {
      vscode.postMessage({ type: 'runDeploy' });
    });

    document.getElementById('btn-login').addEventListener('click', () => {
      vscode.postMessage({ type: 'login' }); // handled via command in extension
    });

    document.getElementById('btn-ai').addEventListener('click', () => {
      const selected = modelSelect.value;
      const latestError = (window.__rwLastError || '').slice(0, 9000);
      vscode.postMessage({
        type: 'aiSuggestions',
        payload: {
          model: selected,
          errorText: latestError
        }
      });
    });

    window.addEventListener('message', (event) => {
      const msg = event.data;
      if (!msg || !msg.type) return;

      switch (msg.type) {
        case 'state':
          if (msg.payload) {
            setSeatState(msg.payload.seatCount);
            setLicenseState(msg.payload.license);
            setApiUrl(msg.payload.apiBaseUrl);
            renderLogs({
              recentErrors: msg.payload.recentErrors,
              recentCommands: msg.payload.recentCommands
            });

            if (msg.payload.recentErrors && msg.payload.recentErrors.length > 0) {
              window.__rwLastError = msg.payload.recentErrors[0].message || '';
            }
          }
          break;
        case 'deployResult':
          // Optional: show something fancy later
          break;
        case 'aiSuggestions':
          renderAiSuggestions(msg.payload);
          break;
        case 'error':
          vscode.postMessage({ type: 'telemetry', payload: msg.payload });
          break;
      }
    });

    // initial handshake
    vscode.postMessage({ type: 'init' });
  </script>
</body>
</html>